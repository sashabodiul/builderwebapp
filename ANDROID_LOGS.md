# Просмотр логов на Android устройстве

Это руководство поможет вам просматривать логи приложения на реальном Android устройстве для отладки проблем с началом/окончанием рабочего дня.

## Способ 1: Удаленная отладка Chrome (Рекомендуется)

### Настройка на Android устройстве:

1. **Включите режим разработчика:**
   - Откройте "Настройки" → "О телефоне"
   - Найдите "Номер сборки" и нажмите на него 7 раз
   - Появится сообщение "Вы стали разработчиком!"

2. **Включите отладку по USB:**
   - Вернитесь в "Настройки" → "Для разработчиков"
   - Включите "Отладка по USB"
   - При первом подключении подтвердите разрешение на компьютере

3. **Подключите устройство к компьютеру по USB**

### Настройка на компьютере:

1. **Откройте Chrome на компьютере**

2. **Перейдите на страницу отладки:**
   ```
   chrome://inspect
   ```

3. **Вы увидите ваше Android устройство в списке**

4. **Нажмите "inspect" рядом с вашим устройством**

5. **Откроется DevTools, где вы сможете:**
   - Видеть консоль с логами в реальном времени
   - Просматривать Network запросы
   - Отлаживать JavaScript код

### Использование функций логирования:

В консоли DevTools доступны следующие функции:

```javascript
// Показать последние 20 логов
showAppLogs()

// Показать все логи в виде таблицы
getAppLogs()

// Экспортировать логи как JSON (также копирует в буфер обмена)
exportAppLogs()

// Очистить все логи
clearAppLogs()
```

## Способ 2: Просмотр логов через консоль в Telegram Web App

Если у вас нет доступа к USB отладке, вы можете использовать встроенные функции:

1. **Откройте приложение в Telegram на Android**

2. **Добавьте `?debug=1` к URL** (если возможно) или используйте специальную команду

3. **Используйте функции логирования:**
   - Логи автоматически сохраняются в `localStorage`
   - Вы можете экспортировать их через функции выше

## Способ 3: Просмотр логов через ADB (для продвинутых)

Если у вас установлен Android Debug Bridge (ADB):

```bash
# Подключите устройство и выполните:
adb logcat | grep -i "chromium\|webview\|telegram"

# Или для просмотра всех логов Chrome:
adb logcat | grep -i chrome
```

## Что логируется

Приложение логирует следующие события:

### Начало рабочего дня:
- Параметры пользователя (ID, тип работника)
- Выбранный объект
- Запрос геолокации и результат
- Данные запроса к API
- Ответ сервера (успех/ошибка)

### Окончание рабочего дня:
- Параметры пользователя
- Количество задач
- Количество фотографий
- Запрос геолокации и результат
- Данные запроса к API
- Ответ сервера (успех/ошибка)

### Ошибки:
- Детальная информация об ошибках
- Коды ошибок геолокации
- Ошибки API с полными данными ответа

## Типичные проблемы и их диагностика

### Проблема: Не могу начать рабочий день

**Проверьте логи:**
```javascript
showAppLogs()
```

**Что искать:**
- `Geolocation error` - проблема с доступом к геолокации
- `Failed to start work` - ошибка API, проверьте `response.error`
- `Cannot start work: object not selected` - не выбран объект

### Проблема: Не могу закончить рабочий день

**Проверьте логи:**
```javascript
showAppLogs()
```

**Что искать:**
- `Geolocation error` - проблема с доступом к геолокации
- `Failed to end work` - ошибка API, проверьте `response.error`
- Проверьте количество фотографий и размер файлов

## Экспорт логов для отправки разработчику

Если нужно отправить логи разработчику:

```javascript
// В консоли DevTools выполните:
const logs = exportAppLogs();
// Логи будут скопированы в буфер обмена и выведены в консоль
// Скопируйте JSON и отправьте разработчику
```

Или сохраните в файл:
```javascript
const logs = exportAppLogs();
const blob = new Blob([logs], { type: 'application/json' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = 'app-logs.json';
a.click();
```

## Очистка логов

Логи автоматически ограничиваются 100 последними записями. Для полной очистки:

```javascript
clearAppLogs()
```

## Примечания

- Логи сохраняются в `localStorage`, поэтому они сохраняются между перезагрузками страницы
- При переполнении хранилища старые логи автоматически удаляются
- Все логи также выводятся в консоль браузера для удобства

